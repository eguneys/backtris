var Tetris=function(t){var n={};function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(i,a,function(n){return t[n]}.bind(null,a));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){t.exports=e(1)},function(t,n,e){e(2);const i=e(3);t.exports=i.app},function(t,n,e){},function(t,n,e){"use strict";e.r(n);const i={Over:"over",Play:"play"},a=Math.PI,o=2*a;function r(t,n){return Math.random()*(n-t)+t}function s(t,n){return Math.floor(r(t,n))}function l(){return Date.now()}const c=(t,n,e=1e3)=>{l()-t>e&&n()},u=(t,n,e)=>{let i=0;return a=>{(i+=a)>=n?(t(),i=0):e&&e(i/n)}},d=(t,n,e)=>{let i=0;return a=>{let o=n(a);(i+=a)>=o?(t(),i=0):e&&e(i/o)}};function h(t,n){const e=n/t,a=.05*t,o=.1*n;return{game:{state:i.Over,width:t,height:n,wallWidth:a,heroWidth:o,ratio:e,heroVx:-40,gravity:10}}}function f(){const t={};return t.scoreLabel=p("SCORE"),t.grid=m(),t}const m=()=>v(1024,1024,(t,n,e,i)=>{const a=.01*n;e.strokeStyle="white",e.lineWidth=1,e.beginPath(),e.fillStyle="white",e.moveTo(0,0);for(let i=0;i<t;i+=a)e.moveTo(i,0),e.lineTo(i,n);for(let i=0;i<n;i+=a)e.moveTo(0,i),e.lineTo(t,i);return e.stroke(),i}),p=t=>v(100*t.length*.5,100,(n,e,i,a)=>(i.font="50pt Comic Sans",i.fillStyle="white",i.textAlign="center",i.textBaseline="middle",i.fillText(t,n/2,50),a));function v(t,n,e){var i=document.createElement("canvas");return i.width=t,i.height=n,e(t,n,i.getContext("2d"),i),i}function x(t,n){return Object.keys(t).reduce((e,i)=>({[i]:n(i,t[i]),...e}),{})}const w={futil:"float usin(float v) {\n  return (sin(v) + 1.0) / 2.0;\n}\n\nfloat sdEquilateralTriangle( in vec2 p ) {\n  const float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdLine( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r )\n{\n  return sdBox(p, b) - r;\n}\n\nfloat opBlend(float d1, float d2, float a)\n{\n return a * d1 + (1.0 - a) * d2;\n}\n\nfloat opUnion(float d1, float d2) {\n  return min(d1, d2);\n}\n\nfloat opSubtraction(float d1, float d2) {\n  return max(-d1, d2);\n}\n\nfloat opIntersection(float d1, float d2) {\n  return max(d1, d2);\n}\n\nvec2 opRep(vec2 p, vec2 c)\n{\n  vec2 q = mod(p,c)-0.5*c;\n  return q;\n}\n\n// vec2 screenToWorld(vec2 screen) {\n//   vec2 result = 2.0 * (screen/uResolution.xy - 0.5);\n//   result.x *= uResolution.x/uResolution.y;\n//   return result;\n// }\n\n// vec2 screenToWorld2(vec2 screen) {\n//   screen.x *= uResolution.x/uResolution.y;\n//   return screen;\n// }\n\nmat3 affineMatrix(vec2 translation, float rotation) {\n  return mat3(cos(rotation), -sin(rotation), 0.0,\n              sin(rotation), cos(rotation), 0.0,\n              translation.x, translation.y, 1.0);\n}\n\nvec2 transform(vec2 p, vec2 trans, float rotate, float scale) {\n  return (-inverse(affineMatrix(trans, rotate)) * vec3(p, 1.0)).xy;\n}\n\n\nvec2 translate(vec2 p, vec2 trans) {\n  return transform(p, trans, 0.0, 1.0);\n}\n\nvec2 rotate(vec2 p, float angle) {\n  return transform(p, vec2(0.0), angle, 1.0);\n}\n",fdefs:"#define PI 3.14\n#define HALFPI (PI * 0.5)\n#define TAU (PI * 2.0)\n",fcolors:"#define colWhite vec4(1.0)\n#define colBlue vec4(0.0, 0.0, 1.0, 1.0)\n#define colYellow vec4(1.0, 1.0, 0.0, 1.0)\n#define colGB vec4(0.0, 1.0, 1.0, 1.0)\n#define colBlack vec4(0.0, 0.0, 0.0, 1.0)\n#define colYellowG vec4(1.0, 1.0, 0.3, 1.0)\n#define colPurpleG vec4(0.2, 0.1, 0.2, 1.0)\n\n",feffects:"// https://www.shadertoy.com/view/3llSz4\nvoid vsprites(out vec4 col, vec2 p) {\n\n  p.y += uTime * 0.001;\n\n  vec4 col1 = vec4(255., 255., 0., 1.0);\n  vec4 col2 = vec4(0., 255., 255., 1.0);\n  vec4 col3 = vec4(255., 0., 180., 1.0);\n\n  float d = mod(floor(p.y * 8.0), 3.0);\n\n  if (d == 0.0) {\n    col = col1;\n  } else if (d == 1.0) {\n    col = col2;\n  } else {\n    col = col3;\n  }\n\n}\n\n\n// https://www.shadertoy.com/view/3tj3Rw\nvoid hsprites(out vec4 col, vec2 p) {\n\n  float res = 2.0;\n\n  float t= uTime * 0.005;\n  t += sin(t) + 1.0;\n  float offset = t * .5;\n  // offset *= ceil(p.y * res) * .25;\n\n  float flip = round(fract(p.y));\n  p.x += (flip-.5) * offset;\n\n  vec2 u = p * res;\n\n  int i = int(ceil(u.x) + ceil(u.y));\n\n  float k = 0.0;\n\n  if (i % 6 == 0) {\n    k += 1.0;\n  }\n\n  vec4 front = vec4(1.0, 1.0, 0.3, 1.0),\n    back = vec4(0.2, 0.1, 0.2, 1.0);\n\n  col = mix(front, back, clamp(k, 0.0, 1.0));\n}\n\n// https://www.shadertoy.com/view/tdjXWW\nfloat sdHalfCircle(vec2 p) {\n  p *= 0.7;\n  p.y += floor(p.y);\n  return sdCircle(p, 0.2);\n}\n\nvoid colHalfCircle(out vec4 col, vec2 p) {\n  float d = sdHalfCircle(p);\n\n  col = colYellow;\n\n  col = mix(col, colBlack, 1.0 - smoothstep(0.0, 0.01, d));\n}\n\n\n// https://www.shadertoy.com/view/ldyyzV\nvoid colPulsingRotations(out vec4 col, vec2 p) {\n\n  float area = 1.2;\n  float size = 0.03;\n\n  float dist = length(p);\n\n  float way = 0.0;\n\n  float max = 28.0;\n\n  float speed = sin(uTime * 0.001);\n\n  if (dist <= area + size) {\n\n    for (float i = 0.0; i < max; i++) {\n      float radius = area - size * 2.0 * i;\n      float angle = speed * (i + 1.0);\n      if (dist > radius && dist < radius + size &&\n          sin(angle) * p.x + cos(angle) * p.y > 0.0) {\n        way = //smoothstep(radius, radius + size / 4.5, dist); //*\n          smoothstep(radius + size, radius + size / 1.2, dist);\n      }\n    }\n  }\n\n\n  col = mix(colBlue, colWhite, way);\n  \n}\n\n// https://www.shadertoy.com/view/4lVXzK\nvoid colGlowyCircle(out vec4 col, vec2 p) {\n\n  float timer = usin(uTime * 0.005);\n\n  float radius = 2.0/timer;\n\n  float ring = length(p)*4.0 - radius;\n  ring = min(3.0, abs(1.0/(10.0*ring)));\n  ring = max(0.0, ring-timer);\n    \n\n  col = vec4(ring * 0.3, ring+ 0.05, ring - 0.05, 1.0);\n  \n}\n"},g=/#include (\w+)/;var y=x({vmain:"#version 300 es\n\nprecision mediump float;\n\nin vec2 aPosition;\n\nin vec2 aTexCoord;\n\nout vec2 vQuadCoord;\n\nuniform vec2 uResolution;\n\nuniform mat3 uMatrix;\n\nvoid main() {\n\n  vec2 position = (uMatrix * vec3(aPosition, 1)).xy;\n\n  vQuadCoord = aTexCoord;\n\n  gl_Position = vec4(position, 0, 1);\n\n}\n",fhero:"#version 300 es\n\n#include fcolors\n#include fdefs\n\nprecision mediump float;\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n#include futil\n#include feffects\n\nvoid main() {\n  \n  outColor = colYellowG;\n  \n}\n",fwall:"#version 300 es\n\n#include fcolors\n#include fdefs\n\nprecision mediump float;\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n#include futil\n#include feffects\n\nvoid main() {\n  \n  outColor = colYellowG;\n  \n}\n",vtexture:"#version 300 es\n\nprecision mediump float;\n\nin vec2 aPosition;\n\nin vec2 aTexCoord;\n\nout vec2 vQuadCoord;\n\nuniform vec2 uResolution;\n\nuniform mat3 uMatrix;\n\nvoid main() {\n\n  vec2 position = (uMatrix * vec3(aPosition, 1)).xy;\n\n  vQuadCoord = (aTexCoord + 1.0) / 2.0;\n\n  gl_Position = vec4(position, 0, 1);\n\n}\n",ftexture:"#version 300 es\n\nprecision mediump float;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\n\nuniform vec2 uSqueeze;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n\nvoid main() {\n  outColor = texture(uTexture, vQuadCoord);\n  // outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",fbg:"#version 300 es\n\n#include fcolors\n#include fdefs\n \nprecision mediump float;\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n#include futil\n#include feffects\n\nvoid main() {\n\n  vec2 p = vQuadCoord;\n  p.x *= uResolution.x/uResolution.y;\n\n  vec4 col = vec4(0.5, 0.5, 0.5, 0.0);\n\n  // colGlowyCircle(col, p);\n  // hsprites(col, p);\n  col = colPurpleG;\n\n\n  outColor = col;\n}\n"},(t,n)=>(function t(n){const e=n.match(g);if(e){e[1];return n=n.replace(e[0],w[e[1]]),t(n)}return n})(n));const T={identity:function(){return[1,0,0,0,1,0,0,0,1]},transform:function(t,n,e,i,a){let o=T.identity();return o=T.multiply(o,T.projection(t[0],t[1])),o=T.multiply(o,T.translation(n[0],n[1])),o=T.multiply(o,T.translation(a[0],a[1])),o=T.multiply(o,T.rotation(e)),o=T.multiply(o,T.scaling(i[0],i[1])),o=T.multiply(o,T.translation(-a[0],-a[1]))},projection:function(t,n){return[2/t,0,0,0,-2/n,0,-1,1,1]},translation:function(t,n){return[1,0,0,0,1,0,t,n,1]},rotation:function(t){var n=Math.cos(t),e=Math.sin(t);return[n,-e,0,e,n,0,0,0,1]},scaling:function(t,n){return[t,0,0,0,n,0,0,0,1]},multiply:function(t,n){var e=t[0],i=t[1],a=t[2],o=t[3],r=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=n[0],h=n[1],f=n[2],m=n[3],p=n[4],v=n[5],x=n[6],w=n[7],g=n[8];return[d*e+h*o+f*l,d*i+h*r+f*c,d*a+h*s+f*u,m*e+p*o+v*l,m*i+p*r+v*c,m*a+p*s+v*u,x*e+w*o+g*l,x*i+w*r+g*c,x*a+w*s+g*u]}};var b=T;function R(t,n){const{width:e,height:i}=t.game;n.clearColor(0,0,0,1),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.disable(n.DEPTH_TEST),this.minibatch=[],this.addTexture=(t,n,e)=>{o(t,{uTexture:[],...e,...a(n,t)})},this.addQuad=(t,n,e={})=>{o(t,{...e,...a(n,t)})};const a=({pivot:t,translation:a,rotation:o,scale:r},s)=>{t=t||[.5*s.width,.5*s.height],a=a||[0,0],o=o||0,r=r||[1,1];const l=b.transform([e,i],a,o,r,t);return{uResolution:[n.canvas.width,n.canvas.height],uMatrix:[l]}},o=(t,n)=>{const e=Object.keys(t.uniforms).map(e=>{let i=t.uniforms[e],a=n[e];return()=>{if(!a)throw new Error("undefined uniform "+e);i(...a)}});this.minibatch.push({...t,uniforms:e})};this.makeQuad=({name:t,vSource:e,fSource:i,uniforms:a},o,r)=>{e=e||y.vmain;let s=P(n,n.VERTEX_SHADER,e),l=P(n,n.FRAGMENT_SHADER,i),c=function(t,n,e){let i=t.createProgram();if(t.attachShader(i,n),t.attachShader(i,e),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;return console.error(t.getProgramInfoLog(i)),t.deleteProgram(i),null}(n,s,l),u=n.getAttribLocation(c,"aPosition"),d=n.createBuffer(),h=n.createVertexArray();n.bindVertexArray(h),n.enableVertexAttribArray(u),n.bindBuffer(n.ARRAY_BUFFER,d);let f=0,m=o,p=0,v=r,w=[f,p,f,v,m,p,f,v,m,p,m,v];n.bufferData(n.ARRAY_BUFFER,new Float32Array(w),n.STATIC_DRAW);let g=2,T=n.FLOAT,b=!1,R=0,E=0;n.vertexAttribPointer(u,g,T,b,R,E);let A=n.getAttribLocation(c,"aTexCoord"),S=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,S),w=[f=-1,p=-1,f,v=1,m=1,p,f,v,m,p,m,v],n.bufferData(n.ARRAY_BUFFER,new Float32Array(w),n.STATIC_DRAW),n.enableVertexAttribArray(A),g=2,T=n.FLOAT,b=!0,R=0,E=0,n.vertexAttribPointer(A,g,T,b,R,E),{name:t,width:o,height:r,program:c,vao:h,uniforms:x(a,(t,e)=>e(n,c))}},this.makeSprite=({texture:t,fSource:e,uniforms:i},a,o)=>{e=e||y.ftexture;let r=this.makeQuad({vSource:y.vtexture,fSource:e,uniforms:{...i,uResolution:S("uResolution"),uMatrix:k("uMatrix"),uTexture:E("uTexture",0)}},a,o),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);const l=n.RGBA,c=n.UNSIGNED_BYTE;return n.texImage2D(n.TEXTURE_2D,0,l,l,c,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),r={texture:s,textureUnit:0,...r}},this.render=()=>{n.viewport(0,0,n.canvas.width,n.canvas.height),n.clear(n.COLOR_BUFFER_BIT),this.minibatch.forEach(({program:t,uniforms:e,vao:i,texture:a,textureUnit:o})=>{n.useProgram(t),e.forEach(t=>t()),a&&(n.activeTexture(n.TEXTURE0+o),n.bindTexture(n.TEXTURE_2D,a)),n.bindVertexArray(i),n.drawArrays(n.TRIANGLES,0,6)}),this.minibatch=[]}}const E=(t,n)=>(e,i)=>()=>e.uniform1i(e.getUniformLocation(i,t),n),A=t=>(n,e)=>(...i)=>n.uniform1f(n.getUniformLocation(e,t),...i),S=t=>(n,e)=>(...i)=>n.uniform2f(n.getUniformLocation(e,t),...i),k=t=>(n,e)=>i=>n.uniformMatrix3fv(n.getUniformLocation(e,t),!1,i);function P(t,n,e){let i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error("Cannot create shader: ["+e+"] "+t.getShaderInfoLog(i)),t.deleteShader(i),null)}function C(t,n){const{width:e,height:i}=t.data.game,a=n.makeQuad({fSource:y.fbg,uniforms:{uTime:A("uTime"),uMatrix:k("uMatrix"),uResolution:S("uResolution")}},e,i);this.render=t=>{const{tick:e}=t.data;n.addQuad(a,{},{uTime:[e]})}}function _(t,n){n={name:"pool",warnLeak:50,...n};const e=(()=>{let t=0;return()=>t++})();let i=[],a=[];this.name=()=>n.name,this.alives=()=>i.length,this.total=()=>a.length+i.length,this.warnLeak=()=>n.warnLeak,this.toString=()=>`[${this.name()} alives: ${this.alives()} deads: ${a.length}]`,this.acquire=(n=(()=>{}))=>{let o;return this.total()>this.warnLeak()&&console.warn(`possible pool leak at ${this.name()}.`),n(o=a.length>0?a.pop():t(e())),i.push(o),o},this.release=t=>{let n=i.indexOf(t);n>-1&&a.push(i.splice(n,1)[0])},this.releaseAll=()=>{a=[...a,...i],i=[]},this.releaseIf=(t,n=(()=>{}))=>{let e=[],o=[];i.forEach(i=>{t(i)?(n(i),e.push(i)):o.push(i)}),i=o,a=[...e,...a]},this.each=t=>{i.forEach(t)},this.find=t=>i.find(t)}function M(t,n){const{width:e,height:i,heroWidth:a,ratio:o}=t.data.game;t.data;let r=n.makeQuad({fSource:y.fhero,uniforms:{uResolution:S("uResolution"),uTime:A("uTime"),uMatrix:k("uMatrix")}},a,a),s=new _(t=>n.makeQuad({name:"bullet"+t,fSource:y.fhero,uniforms:{uMatrix:k("uMatrix")}},.3*a,.3*a),{name:"bulletQuad"});this.render=t=>{(t=>{const{tick:e}=t.data,i=t.play.hero,{x:a}=t.play.camera.data,{x:o,y:s}=i.data;n.addQuad(r,{translation:[o-a,s]},{uTime:[e]})})(t),t.play.bullets.bullets.each(e=>((t,e)=>{const{x:i}=t.play.camera.data,{x:a,y:o}=e.data;let r=s.acquire();n.addQuad(r,{translation:[a-i,o]})})(t,e))},this.release=()=>{s.releaseAll()}}function L(t,n){const{width:e,height:i,wallWidth:a}=t.data.game,o=new _(t=>n.makeQuad({name:"wall"+t,fSource:y.fwall,uniforms:{uMatrix:k("uMatrix")}},a,a),{name:"wallQuads"});this.render=t=>{const{x:e}=t.play.camera.data,i=t.play.walls;i.walls.each(t=>{const{x:i,y:a}=t.data;let r=o.acquire();n.addQuad(r,{translation:[i-e,a]})}),i.fallingWalls.each(t=>{const{x:i,y:a,rotation:r}=t.data;let s=o.acquire();n.addQuad(s,{translation:[i-e,a],rotation:r})})},this.release=()=>{o.releaseAll()}}function Q(t,n){const{width:e,height:i,wallWidth:a}=t.data.game,o=new _(t=>n.makeQuad({name:"block"+t,fSource:y.fwall,uniforms:{uMatrix:k("uMatrix")}},a,a),{name:"blockQuads"});this.render=t=>{const{x:e}=t.play.camera.data;t.play.blocks.blocks.each(t=>{const{x:i,y:a}=t.data;let r=o.acquire();n.addQuad(r,{translation:[i-e,a]})})},this.release=()=>{o.releaseAll()}}function U(t,n){const{width:e,height:i}=t.data,a=new C(t,n),o=new M(t,n),r=new L(t,n),s=new Q(t,n);this.render=t=>{a.render(t),r.render(t),s.render(t),o.render(t)},this.release=()=>{r.release(),s.release(),o.release()}}function W(t,n){const{width:e,height:i,textures:a}=t.data,o=.2*e,r=.2*i;let s=n.makeSprite({texture:a.scoreLabel},o,r);this.render=t=>{n.addTexture(s,{translation:[(e-o)/2,(i-r)/2],rotation:0*Math.PI,scale:[1,1],pivot:[.5*e,.5*i]})}}function I(t,n){const{width:e,height:i}=t.data,a=new U(t,n);new W(t,n);this.render=t=>{a.render(t)},this.release=()=>{a.release()}}function B(t,n){const{width:e,height:i}=t.data.game;let a;this.init=()=>{this.data=a={...r()}};let o=.2*e;this.update=n=>{const e=t.hero,{x:i}=e.data;i<o&&(a.x=i-o)};const r=()=>({x:0})}const D={Top:"top",Left:"left",Right:"right",Bottom:"bottom",None:"none"};function O(t,n){const{width:e,height:i,wallWidth:a,heroWidth:o,gravity:r,heroVx:s}=t.data.game;let c;this.init=t=>{this.data=c={...p()}};let u=0;let d=0;let h=!1;const f=t=>{h&&d<2&&(h=!1,d++,(t=>{u=0,c.vy=-c.jumpVy,1===d&&(c.vx*=2),2===d&&(c.vy*=.8)})())},m=()=>{const n=t.walls.walls.find(t=>(function(t,n){return t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y})(t.data,c)&&function(t,n){const e=n.y+n.height,i=n.x+n.width,a=t.y+t.height,o=t.x+t.width,r=a-n.y,s=e-t.y,l=i-t.x,c=o-n.x;let u=D.None;return s<r&&s<l&&s<c?u=D.Top:r<s&&r<l&&r<c?u=D.Bottom:l<c&&l<s&&l<r?u=D.Left:c<l&&c<s&&c<r&&(u=D.Right),u}(t.data,c)===D.Top);n&&(t=>{d=0,u=-r,c.vy=0,c.y=t.data.y-c.height})(n)};this.userJump=()=>{h=!0},this.update=n=>{(n=>{c.y-o>i&&0===t.data.gameover&&(t.data.gameover=l())})(),f(),(t=>{const n=.01*t,e=c.y;c.vy+=u*n,c.vy+=r*n,c.x+=c.vx*n,c.y+=c.vy*n,m(e,c.y),c.vx+=(s-c.vx)*n,u=0})(n)};const p=()=>({width:o,height:o,x:e-o,y:.5*i-a,vx:-0,vy:0,ay:0,jumpVy:6*r})}function F(t,n){const{width:e,height:i,wallWidth:a}=t.data.game;let o;this.walls=new _(()=>new j(t,n)),this.fallingWalls=new _(()=>new j(t,n)),this.init=()=>{o=e,this.data=d(),this.walls.releaseAll(),this.fallingWalls.releaseAll();l(20,.5*i-a)};const r=t=>{const n=this.walls.acquire(n=>n.init({height:t,x:o}));return o-=1*n.data.width,n},l=(t,n)=>{for(let e=0;e<t;e++)r(n);o-=2*a},c=t=>{this.fallingWalls.acquire(n=>{n.init({x:t.data.x,height:t.data.height,falling:!0})})},u=n=>{const{x:i}=t.camera.data;this.walls.releaseIf(t=>t.data.x<.5*e&&t.data.x-.5*e>i,c),this.fallingWalls.releaseIf(t=>t.data.x-e>i)};this.update=n=>{(n=>{const{x:e}=t.camera.data;if(o>e){const t=s(.1*i,.4*i),n=s(8,20);l(n,t)}})(),u(),this.walls.each(t=>t.update(n)),this.fallingWalls.each(t=>t.update(n))};const d=()=>({x:0})}function j(t,n){const{width:e,height:i,gravity:o,wallWidth:r}=t.data.game;this.init=t=>{this.data={...c(),...t},this.data.y=i-this.data.height};const s=t=>{const n=.01*t;this.data.rotation+=-.2*a*n,this.data.y+=o*n},l=t=>{this.data.falling&&s(t)};this.update=t=>{l(t)};const c=()=>({x:0,width:r,height:r,rotation:0,falling:!1})}function q(t,n){const{width:e,height:i}=t.data.game;this.bullets=new _(()=>new H(t,n)),this.init=()=>{this.data={}};const a=u(()=>{const{x:n}=t.camera.data,i=t.hero.data,a=i.x,o=i.y;this.bullets.acquire(t=>t.init({x:a,y:o})),this.bullets.releaseIf(t=>t.data.x-.7*e>n)},150);this.update=t=>{a(t),this.bullets.each(n=>n.update(t))}}function H(t,n){this.init=t=>{this.data={...e(),...t}};this.update=t=>{const n=.01*t;this.data.vx+=(1-this.data.vx)*n,this.data.y+=150*-Math.sin(this.data.vx*o*.6)*n,this.data.x+=150*-Math.cos(this.data.vx*a)*n};const e=()=>({x:0,y:0,vx:0})}function V(t,n){const{width:e,height:i}=t.data.game;this.blocks=new _(()=>new X(t,n)),this.init=()=>{this.data={}};const a=d(()=>{const{x:n}=t.camera.data;this.blocks.acquire(t=>t.init({x:n+e,y:r(.2*i,.5*i)})),this.blocks.releaseIf(t=>t.data.x<n)},()=>s(1e3,2e3));this.update=t=>{a(t),this.blocks.each(n=>n.update(t))}}function X(t,n){const{width:e,height:i,heroVx:a}=t.data.game;this.init=t=>{this.data={...o(),...t}},this.update=t=>{const n=.01*t;this.data.x+=.5*a+n};const o=()=>({x:e,y:.5*i})}function G(t,n){this.data=t.data,this.camera=new B(this,n),this.hero=new O(this,n),this.walls=new F(this,n),this.bullets=new q(this,n),this.blocks=new V(this,n),this.init=()=>{this.data.gameover=0,this.camera.init(),this.hero.init(),this.walls.init(),this.bullets.init(),this.blocks.init()},this.spaceHit=()=>{this.hero.userJump()};const e=t=>{this.data.gameover>0&&c(this.data.gameover,()=>{this.data.gameover=0,this.data.state=i.Over},1e3)};this.update=t=>{e(),this.hero.update(t),this.walls.update(t),this.bullets.update(t),this.blocks.update(t),this.camera.update(t)}}function N(t,n){this.data={tick:0,...t},this.play=new G(this,n),this.play.init(this),this.spaceHit=()=>{this.data.state===i.Play?this.play.hero.userJump():(this.play.init(this),this.data.state=i.Play)},this.update=t=>{this.data.tick++,this.play.update(t)}}const z=void 0!==window.performance?window.performance:Date,Y=()=>z.now(),$=window.requestAnimationFrame;function J(t,n=60){let e=!1,i=Y(),a=0,o=1e3/n,r=0;this.start=()=>e?this:(e=!0,i=Y(),a=$(s),this),this.stop=()=>(e=!1,0!=a&&$.cancel(a),a=0,this);const s=()=>{a=$(s);const n=Y(),e=n-i;(r+=e)>=o&&(t(e),r=0),i=n}}function K(t,n,e){return t.addEventListener(n,e),()=>t.removeEventListener(n,e)}function Z(t,n){const e=document.createElement("canvas"),i=e.getContext("webgl2");t.append(e);const a=e.clientWidth,o=e.clientHeight;e.width=a,e.height=o;const r={...h(a,o),textures:f()};let s=new R(r,i),l=new N(r,s),c=new I(l,s);new J(t=>{l.update(t),c.render(l),s.render(),c.release()},60).start(),function(t){const n=[],e=function(t){return function(n){switch(n.code){case"Space":t.spaceHit();break;default:return}n.preventDefault()}}(t),i=function(t){t.code};n.push(K(document,"keydown",e)),n.push(K(document,"keyup",i))}(l)}e.d(n,"app",function(){return Z})}]);