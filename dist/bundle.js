var Tetris=function(n){var e={};function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:o})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(o,r,function(e){return n[e]}.bind(null,r));return o},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=0)}([function(n,e,t){n.exports=t(1)},function(n,e,t){t(2);const o=t(3);n.exports=o.app},function(n,e,t){},function(n,e,t){"use strict";function o(n,e){const t=.1*e;return{game:{unit:30,width:n,height:e,ratio:e/n,vx:10,tick:0},hole:{x:.5*n,y:.5*e,impact:.5,radius:.3*n,fWidth:.5*n,fHeight:.5*e,fG:1},hero:{width:t,height:t,theta:0,w:.1,x:0,y:0,j:0,vy:0,aCy:-1,mass:1,squeeze:.5}}}function r(){const n={};return n.scoreLabel=a("SCORE"),n.grid=i(),n}t.r(e);const i=()=>c(1024,1024,(n,e,t,o)=>{const r=.01*e;t.strokeStyle="white",t.lineWidth=1,t.beginPath(),t.fillStyle="white",t.moveTo(0,0);for(let o=0;o<n;o+=r)t.moveTo(o,0),t.lineTo(o,e);for(let o=0;o<e;o+=r)t.moveTo(0,o),t.lineTo(n,o);return t.stroke(),o}),a=n=>c(100*n.length*.5,100,(e,t,o,r)=>(o.font="50pt Comic Sans",o.fillStyle="white",o.textAlign="center",o.textBaseline="middle",o.fillText(n,e/2,50),r));function c(n,e,t){var o=document.createElement("canvas");return o.width=n,o.height=e,t(n,e,o.getContext("2d"),o),o}function l(n,e){return Object.keys(n).reduce((t,o)=>({[o]:e(o,n[o]),...t}),{})}const u={futil:"float usin(float v) {\n  return (sin(v) + 1.0) / 2.0;\n}\n\nfloat sdEquilateralTriangle( in vec2 p ) {\n  const float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x+k*p.y>0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdLine( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdBox( in vec2 p, in vec2 b )\n{\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdRoundedBox(vec2 p, vec2 b, float r )\n{\n  return sdBox(p, b) - r;\n}\n\nfloat opBlend(float d1, float d2, float a)\n{\n return a * d1 + (1.0 - a) * d2;\n}\n\nfloat opUnion(float d1, float d2) {\n  return min(d1, d2);\n}\n\nfloat opSubtraction(float d1, float d2) {\n  return max(-d1, d2);\n}\n\nfloat opIntersection(float d1, float d2) {\n  return max(d1, d2);\n}\n\nvec2 opRep(vec2 p, vec2 c)\n{\n  vec2 q = mod(p,c)-0.5*c;\n  return q;\n}\n\n// vec2 screenToWorld(vec2 screen) {\n//   vec2 result = 2.0 * (screen/uResolution.xy - 0.5);\n//   result.x *= uResolution.x/uResolution.y;\n//   return result;\n// }\n\n// vec2 screenToWorld2(vec2 screen) {\n//   screen.x *= uResolution.x/uResolution.y;\n//   return screen;\n// }\n\nmat3 affineMatrix(vec2 translation, float rotation) {\n  return mat3(cos(rotation), -sin(rotation), 0.0,\n              sin(rotation), cos(rotation), 0.0,\n              translation.x, translation.y, 1.0);\n}\n\nvec2 transform(vec2 p, vec2 trans, float rotate, float scale) {\n  return (-inverse(affineMatrix(trans, rotate)) * vec3(p, 1.0)).xy;\n}\n\n\nvec2 translate(vec2 p, vec2 trans) {\n  return transform(p, trans, 0.0, 1.0);\n}\n\nvec2 rotate(vec2 p, float angle) {\n  return transform(p, vec2(0.0), angle, 1.0);\n}\n",fdefs:"#define PI 3.14\n#define HALFPI (PI * 0.5)\n#define TAU (PI * 2.0)\n",feffects:"#define colWhite vec4(1.0)\n#define colBlue vec4(0.0, 0.0, 1.0, 1.0)\n#define colYellow vec4(1.0, 1.0, 0.0, 1.0)\n#define colGB vec4(0.0, 1.0, 1.0, 1.0)\n#define colBlack vec4(0.0, 0.0, 0.0, 1.0)\n\n// https://www.shadertoy.com/view/3llSz4\nvoid vsprites(out vec4 col, vec2 p) {\n\n  p.y += uTime * 0.001;\n\n  vec4 col1 = vec4(255., 255., 0., 1.0);\n  vec4 col2 = vec4(0., 255., 255., 1.0);\n  vec4 col3 = vec4(255., 0., 180., 1.0);\n\n  float d = mod(floor(p.y * 8.0), 3.0);\n\n  if (d == 0.0) {\n    col = col1;\n  } else if (d == 1.0) {\n    col = col2;\n  } else {\n    col = col3;\n  }\n\n}\n\n\n// https://www.shadertoy.com/view/3tj3Rw\nvoid hsprites(out vec4 col, vec2 p) {\n\n  float res = 2.0;\n\n  float t= uTime * 0.005;\n  t += sin(t) + 1.0;\n  float offset = t * .5;\n  // offset *= ceil(p.y * res) * .25;\n\n  float flip = round(fract(p.y));\n  p.x += (flip-.5) * offset;\n\n  vec2 u = p * res;\n\n  int i = int(ceil(u.x) + ceil(u.y));\n\n  float k = 0.0;\n\n  if (i % 6 == 0) {\n    k += 1.0;\n  }\n\n  vec4 front = vec4(1.0, 1.0, 0.3, 1.0),\n    back = vec4(0.2, 0.1, 0.2, 1.0);\n\n  col = mix(front, back, clamp(k, 0.0, 1.0));\n}\n\n// https://www.shadertoy.com/view/tdjXWW\nfloat sdHalfCircle(vec2 p) {\n  p *= 0.7;\n  p.y += floor(p.y);\n  return sdCircle(p, 0.2);\n}\n\nvoid colHalfCircle(out vec4 col, vec2 p) {\n  float d = sdHalfCircle(p);\n\n  col = colYellow;\n\n  col = mix(col, colBlack, 1.0 - smoothstep(0.0, 0.01, d));\n}\n\n\n// https://www.shadertoy.com/view/ldyyzV\nvoid colPulsingRotations(out vec4 col, vec2 p) {\n\n  float area = 1.2;\n  float size = 0.03;\n\n  float dist = length(p);\n\n  float way = 0.0;\n\n  float max = 28.0;\n\n  float speed = sin(uTime * 0.001);\n\n  if (dist <= area + size) {\n\n    for (float i = 0.0; i < max; i++) {\n      float radius = area - size * 2.0 * i;\n      float angle = speed * (i + 1.0);\n      if (dist > radius && dist < radius + size &&\n          sin(angle) * p.x + cos(angle) * p.y > 0.0) {\n        way = //smoothstep(radius, radius + size / 4.5, dist); //*\n          smoothstep(radius + size, radius + size / 1.2, dist);\n      }\n    }\n  }\n\n\n  col = mix(colBlue, colWhite, way);\n  \n}\n"},s=/#include (\w+)/;var d=l({vmain:"#version 300 es\n\nprecision mediump float;\n\nin vec2 aPosition;\n\nin vec2 aTexCoord;\n\nout vec2 vQuadCoord;\n\nuniform vec2 uResolution;\n\nuniform mat3 uMatrix;\n\nvoid main() {\n\n  vec2 position = (uMatrix * vec3(aPosition, 1)).xy;\n\n  vQuadCoord = aTexCoord;\n\n  gl_Position = vec4(position, 0, 1);\n\n}\n",fmain:"#version 300 es\n\n#include fdefs\n \nprecision mediump float;\n\nuniform float uTime;\nuniform vec2 uResolution;\n\nuniform vec2 uSqueeze;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n#include futil\n\nfloat sdHeroBubble(vec2 p, vec2 trans, float rot) {\n  vec2 pBubbles = \n    transform(p, trans, rot, 1.0);\n  float bubbles = sdCircle(pBubbles, 0.5);\n\n  return bubbles;\n}\n\n\nvoid heroColor(out vec4 col, vec2 p) {\n\n  vec2 p2 = rotate(p, uSqueeze.x);\n  float wedgeBox = sdRoundedBox(p2, vec2(0.5, 0.01), 0.2);\n\n  vec2 pSmall = transform(p, vec2(0.0, 0.0), 0.0, 1.0);\n  float wedgeCircle = sdCircle(pSmall, 0.4);\n\n\n  pSmall = transform(p, vec2(0.0, 0.0), uSqueeze.x, 0.2);\n  float hBox = sdRoundedBox(pSmall, vec2(0.2, 0.001), 0.1);\n\n  pSmall = translate(pSmall, vec2(0.0, 0.1));\n  float hCircle = sdCircle(pSmall, 0.01);\n\n\n  float highlight = opBlend(hBox, hCircle,\n                            uSqueeze.y);\n  // highlight = hCircle;\n  \n  float wedge = opBlend(wedgeBox, wedgeCircle, \n                        uSqueeze.y);\n\n  float hero = wedge;\n  // hero = wedgeBox;\n\n  col = mix(col, vec4(0.0, 1.0, 0.0, 1.0), 1.0-smoothstep(0.0, 0.1, abs(hero)));\n\n  col = mix(col, vec4(1.0, 0.0, 0.0, 1.0), 1.0-smoothstep(0.0, 0.08, hero));\n\n  col = mix(col, vec4(1.0, 1.0, 1.0, 1.0), 1.0-smoothstep(0.0, 0.18, highlight));\n\n}\n\nvoid wallColor(out vec4 col, vec2 p) {\n  float wall = sdLine(p, vec2(0.0), vec2(-1.0));\n\n  col = mix(col, vec4(1.0, 0.0, 1.0, 1.0), 1.0-smoothstep(0.0, 0.1,wall));\n}\n\nvoid sceneColor(out vec4 col, vec2 p) {\n\n  heroColor(col, p);\n  wallColor(col, p);\n}\n\n\nvoid main() {\n\n  vec2 p = vQuadCoord;\n\n  vec4 col = vec4(0.5, 0.5, 0.5, 0.0);\n\n  sceneColor(col, p);\n\n  outColor = col;\n}\n",vtexture:"#version 300 es\n\nprecision mediump float;\n\nin vec2 aPosition;\n\nin vec2 aTexCoord;\n\nout vec2 vQuadCoord;\n\nuniform vec2 uResolution;\n\nuniform mat3 uMatrix;\n\nvoid main() {\n\n  vec2 position = (uMatrix * vec3(aPosition, 1)).xy;\n\n  vQuadCoord = (aTexCoord + 1.0) / 2.0;\n\n  gl_Position = vec4(position, 0, 1);\n\n}\n",ftexture:"#version 300 es\n\nprecision mediump float;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform sampler2D uTexture;\n\nuniform vec2 uSqueeze;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n\nvoid main() {\n  outColor = texture(uTexture, vQuadCoord);\n  // outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",fbg:"#version 300 es\n\n#include fdefs\n \nprecision mediump float;\n\nuniform vec2 uResolution;\nuniform float uTime;\n\nin vec2 vQuadCoord;\n\nout vec4 outColor;\n\n#include futil\n#include feffects\n\nvoid main() {\n\n  vec2 p = vQuadCoord;\n  p.x *= uResolution.x/uResolution.y;\n\n  vec4 col = vec4(0.5, 0.5, 0.5, 0.0);\n\n  hsprites(col, p);\n  // colHalfCircle(col, p);\n  //colPulsingRotations(col, p);\n\n  outColor = col;\n}\n"},(n,e)=>(function n(e){const t=e.match(s);if(t){t[1];return e=e.replace(t[0],u[t[1]]),n(e)}return e})(e));Math.PI;function f(n,e,t){var o=Math.max(0,Math.min(1,(t-n)/(e-n)));return o*o*(3-2*o)}const v={identity:function(){return[1,0,0,0,1,0,0,0,1]},transform:function(n,e,t,o,r){let i=v.identity();return i=v.multiply(i,v.projection(n[0],n[1])),i=v.multiply(i,v.translation(e[0],e[1])),i=v.multiply(i,v.translation(r[0],r[1])),i=v.multiply(i,v.rotation(t)),i=v.multiply(i,v.scaling(o[0],o[1])),i=v.multiply(i,v.translation(-r[0],-r[1]))},projection:function(n,e){return[2/n,0,0,0,-2/e,0,-1,1,1]},translation:function(n,e){return[1,0,0,0,1,0,n,e,1]},rotation:function(n){var e=Math.cos(n),t=Math.sin(n);return[e,-t,0,t,e,0,0,0,1]},scaling:function(n,e){return[n,0,0,0,e,0,0,0,1]},multiply:function(n,e){var t=n[0],o=n[1],r=n[2],i=n[3],a=n[4],c=n[5],l=n[6],u=n[7],s=n[8],d=e[0],f=e[1],v=e[2],p=e[3],m=e[4],h=e[5],x=e[6],g=e[7],y=e[8];return[d*t+f*i+v*l,d*o+f*a+v*u,d*r+f*c+v*s,p*t+m*i+h*l,p*o+m*a+h*u,p*r+m*c+h*s,x*t+g*i+y*l,x*o+g*a+y*u,x*r+g*c+y*s]}};var p=v;function m(n,e){const{width:t,height:o}=n.game;e.clearColor(0,0,0,1),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),e.disable(e.DEPTH_TEST),this.minibatch=[],this.addTexture=(n,e,t)=>{i(n,{uTexture:[],...t,...r(e,n)})},this.addQuad=(n,e,t)=>{i(n,{...t,...r(e,n)})};const r=({pivot:n,translation:r,rotation:i,scale:a},c)=>{n=n||[.5*c.width,.5*c.height],r=r||[0,0],i=i||0,a=a||[1,1];const l=p.transform([t,o],r,i,a,n);return{uResolution:[e.canvas.width,e.canvas.height],uMatrix:[l]}},i=(n,e)=>{const t=Object.keys(n.uniforms).map(t=>{let o=n.uniforms[t],r=e[t];return()=>{if(!r)throw new Error("undefined uniform "+t);o(...r)}});this.minibatch.push({...n,uniforms:t})};this.makeQuad=({name:n,vSource:t,fSource:o,uniforms:r},i,a)=>{t=t||d.vmain;let c=w(e,e.VERTEX_SHADER,t),u=w(e,e.FRAGMENT_SHADER,o),s=function(n,e,t){let o=n.createProgram();if(n.attachShader(o,e),n.attachShader(o,t),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS))return o;return console.error(n.getProgramInfoLog(o)),n.deleteProgram(o),null}(e,c,u),f=e.getAttribLocation(s,"aPosition"),v=e.createBuffer(),p=e.createVertexArray();e.bindVertexArray(p),e.enableVertexAttribArray(f),e.bindBuffer(e.ARRAY_BUFFER,v);let m=0,h=i,x=0,g=a,y=[m,x,m,g,h,x,m,g,h,x,h,g];e.bufferData(e.ARRAY_BUFFER,new Float32Array(y),e.STATIC_DRAW);let T=2,b=e.FLOAT,R=!1,S=0,C=0;e.vertexAttribPointer(f,T,b,R,S,C);let E=e.getAttribLocation(s,"aTexCoord"),A=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,A),y=[m=-1,x=-1,m,g=1,h=1,x,m,g,h,x,h,g],e.bufferData(e.ARRAY_BUFFER,new Float32Array(y),e.STATIC_DRAW),e.enableVertexAttribArray(E),T=2,b=e.FLOAT,R=!0,S=0,C=0,e.vertexAttribPointer(E,T,b,R,S,C),{name:n,width:i,height:a,program:s,vao:p,uniforms:l(r,(n,t)=>t(e,s))}},this.makeSprite=({texture:n,fSource:t,uniforms:o},r,i)=>{t=t||d.ftexture;let a=this.makeQuad({vSource:d.vtexture,fSource:t,uniforms:{...o,uResolution:g("uResolution"),uMatrix:y("uMatrix"),uTexture:h("uTexture",0)}},r,i),c=e.createTexture();e.bindTexture(e.TEXTURE_2D,c);const l=e.RGBA,u=e.UNSIGNED_BYTE;return e.texImage2D(e.TEXTURE_2D,0,l,l,u,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),a={texture:c,textureUnit:0,...a}},this.render=()=>{e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT),this.minibatch.forEach(({program:n,uniforms:t,vao:o,texture:r,textureUnit:i})=>{e.useProgram(n),t.forEach(n=>n()),r&&(e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,r)),e.bindVertexArray(o),e.drawArrays(e.TRIANGLES,0,6)}),this.minibatch=[]}}const h=(n,e)=>(t,o)=>()=>t.uniform1i(t.getUniformLocation(o,n),e),x=n=>(e,t)=>(...o)=>e.uniform1f(e.getUniformLocation(t,n),...o),g=n=>(e,t)=>(...o)=>e.uniform2f(e.getUniformLocation(t,n),...o),y=n=>(e,t)=>o=>e.uniformMatrix3fv(e.getUniformLocation(t,n),!1,o);function w(n,e,t){let o=n.createShader(e);return n.shaderSource(o,t),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)?o:(console.error("Cannot create shader: ["+t+"] "+n.getShaderInfoLog(o)),n.deleteShader(o),null)}function T(n,e){const{width:t,height:o}=n.data.game,r=e.makeQuad({fSource:d.fbg,uniforms:{uTime:x("uTime"),uMatrix:y("uMatrix"),uResolution:g("uResolution")}},t,o);this.render=n=>{const{tick:t}=n.data.game;e.addQuad(r,{},{uTime:[t]})}}function b(n,e){const{textures:t}=n.data,{width:o,height:r}=n.data.game,i=new T(n,e);this.render=n=>{i.render(n)}}function R(n,e){const{width:t,height:o}=n.data.game,{textures:r}=n.data,i=.2*t,a=.2*o;let c=e.makeSprite({texture:r.scoreLabel},i,a);this.render=n=>{e.addTexture(c,{translation:[(t-i)/2,(o-a)/2],rotation:0*Math.PI,scale:[1,1],pivot:[.5*t,.5*o]})}}function S(n,e){const{width:t,height:o}=n.data.game,r=new b(n,e);new R(n,e);this.render=n=>{r.render(n)}}function C(n,e){const{width:t,height:o}=n.data.game,r=o/t,{hole:i,hero:a}=n.data;let c=0;const l=n=>{const e=a.w*n*.01;a.theta+=e,(()=>{const n=Math.cos(a.theta)*(i.radius-a.j)/r,e=Math.sin(a.theta)*(i.radius-a.j);a.x=.5*t-.5*a.width+n,a.y=.5*o-.5*a.width+e})();const l=i.fG/a.mass;a.vy+=l*n*.01,a.vy+=a.aCy*n*.01,a.j+=a.vy*n*.01,a.j+=(c-a.j)*n*.002,a.j>=.5*i.radius&&(console.log("here"),a.mass=1,a.vy=0,a.j=.5*i.radius,c=0),a.j<.2*-i.radius&&(console.log("less"),a.mass=1,a.vy=0,a.j=.2*-i.radius,c=0)},u=n=>{a.mass=.02};let s=!1;this.userJump=()=>{s=!0},this.update=e=>{(e=>{s?(s=!1,u()):a.j<10&&(n.jumpOver(a.x,a.y),u())})(),l(e)}}function E(n,e){const{hole:t}=n.data,o=function(n){const e=n.length-1;return t=>{const o=Math.floor(t/(1/e)),r=o+1;return n[o]+(n[r]-n[o])*f(0,1/e,t%(1/e))}}([.5,.55,.4,.75,.35,.5]);let r=0;this.doImpact=(n,e)=>{r=1,t.x=n,t.y=e},this.update=n=>{t.impact=o(r),r+=(0-r)*n*.001}}function A(n,e){this.data=n;const t=new C(this,e),o=new E(this,e);this.jumpOver=(n,e)=>{o.doImpact(n,e)},this.spaceHit=()=>{t.userJump()},this.update=n=>{this.data.game.tick+=n,t.update(n),o.update(n)}}const P=void 0!==window.performance?window.performance:Date,_=()=>P.now(),B=window.requestAnimationFrame;function M(n,e=60){let t=!1,o=_(),r=0,i=1e3/e,a=0;this.start=()=>t?this:(t=!0,o=_(),r=B(c),this),this.stop=()=>(t=!1,0!=r&&B.cancel(r),r=0,this);const c=()=>{r=B(c);const e=_(),t=e-o;(a+=t)>=i&&(n(t),a=0),o=e}}function k(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)}function U(n,e){const t=document.createElement("canvas"),i=t.getContext("webgl2");n.append(t);const a=t.clientWidth,c=t.clientHeight;t.width=a,t.height=c;const l={...o(a,c),textures:r()};let u=new m(l,i),s=new A(l,u),d=new S(s,u);new M(n=>{s.update(n),d.render(s),u.render()},60).start(),function(n){const e=[],t=function(n){return function(e){switch(e.code){case"Space":n.spaceHit();break;default:return}e.preventDefault()}}(n),o=function(n){n.code};e.push(k(document,"keydown",t)),e.push(k(document,"keyup",o))}(s)}t.d(e,"app",function(){return U})}]);